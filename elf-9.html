<!DOCTYPE html><head><link rel="stylesheet" href="style.css" type="text/css" media="all"/><style type="text/css">.code-black-background{color:#e0e0e0;background-color:#1f1f1f;}</style></head><body><div class="entry-title entry-title-no-feat-img">
<h1>Elf #9 - Shinny Upatree - Sleigh Bell Lottery Cranberry Pi terminal</h1>
</div><div class="entry-content">
<figure class="wp-block-image">
  <img src="unlinked-function.gif" alt="" class="wp-image-796">
</figure>
<hr class="wp-block-separator">
<h2>Shinny Upatree - Sleigh Bell Lottery Cranberry Pi terminal</h2>
<p>Hints given:
  <br>https://pen-testing.sans.org/blog/2018/12/11/using-gdb-to-call-random-functions
</p>
<p>
  <br>I&apos;ll hear the bells on Christmas Day
  <br>Their sweet, familiar sound will play
  <br>But just one elf,
  <br>Pulls off the shelf,
  <br>The bells to hang on Santa&apos;s sleigh!
  <br>
  <br>Please call me Shinny Upatree
  <br>I write you now, &apos;cause I would be
  <br>The one who gets -
  <br>Whom Santa lets
  <br>The bells to hang on Santa&apos;s sleigh!
  <br>
  <br>But all us elves do want the job,
  <br>Conveying bells through wint&apos;ry mob
  <br>To be the one
  <br>Toy making&apos;s done
  <br>The bells to hang on Santa&apos;s sleigh!
  <br>
  <br>To make it fair, the Man devised
  <br>A fair and simple compromise.
  <br>A random chance,
  <br>The winner dance!
  <br>The bells to hang on Santa&apos;s sleigh!
  <br>
  <br>Now here I need your hacker skill.
  <br>To be the one would be a thrill!
  <br>Please do your best,
  <br>And rig this test
  <br>The bells to hang on Santa&apos;s sleigh!
  <br>
  <br>Complete this challenge by winning the sleighbell lottery for Shinny Upatree.
</p>
<hr class="wp-block-separator">
<div style="height:20px" aria-hidden="true" class="wp-block-spacer"></div>
<p>List the directory</p>
<pre class="wp-block-code code-black-background"><code>elf@7b861946cf3f:~$ ls -al
total 60
drwxr-xr-x 1 elf  elf   4096 Dec 14 16:22 .
drwxr-xr-x 1 root root  4096 Dec 14 16:21 ..
-rw-r--r-- 1 elf  elf    220 Apr  4  2018 .bash_logout
-rw-r--r-- 1 elf  elf   3785 Dec 14 16:21 .bashrc
-rw-r--r-- 1 elf  elf    807 Apr  4  2018 .profile
lrwxrwxrwx 1 elf  elf     12 Dec 14 16:21 gdb -&gt; /usr/bin/gdb
lrwxrwxrwx 1 elf  elf     16 Dec 14 16:21 objdump -&gt; /usr/bin/objdump
-rwxr-xr-x 1 root root 38144 Dec 14 16:22 sleighbell-lotto</code></pre>
<div style="height:20px" aria-hidden="true" class="wp-block-spacer"></div>
<p>List the symbols of file &apos;sleighbell-lotto&apos;</p>
<pre class="wp-block-code code-black-background"><code>elf@7b861946cf3f:~$ nm ./sleighbell-lotto
         U EVP_sha256@@OPENSSL_1_1_0
         U HMAC@@OPENSSL_1_1_0
0000000000207d40 d _DYNAMIC
0000000000207f40 d _GLOBAL_OFFSET_TABLE_
0000000000001630 R _IO_stdin_used
         w _ITM_deregisterTMCloneTable
         w _ITM_registerTMCloneTable
000000000000702c r __FRAME_END__
0000000000006dcc r __GNU_EH_FRAME_HDR
0000000000208068 D __TMC_END__
0000000000208068 B __bss_start
         w __cxa_finalize@@GLIBC_2.2.5
0000000000208000 D __data_start
0000000000000ac0 t __do_global_dtors_aux
0000000000207d38 t __do_global_dtors_aux_fini_array_entry
0000000000208008 D __dso_handle
0000000000207d30 t __frame_dummy_init_array_entry
         w __gmon_start__
0000000000207d38 t __init_array_end
0000000000207d30 t __init_array_start
0000000000001620 T __libc_csu_fini
00000000000015b0 T __libc_csu_init
         U __libc_start_main@@GLIBC_2.2.5
         U __stack_chk_fail@@GLIBC_2.4
0000000000208068 D _edata
0000000000208080 B _end
0000000000001624 T _fini
00000000000008c8 T _init
0000000000000a00 T _start
0000000000000c1e T base64_cleanup
0000000000000c43 T base64_decode
0000000000000bcc T build_decoding_table
0000000000208068 b completed.7696
0000000000208000 W data_start
0000000000208070 B decoded_data
0000000000208078 b decoding_table
0000000000000a30 t deregister_tm_clones
0000000000208020 d encoding_table
         U exit@@GLIBC_2.2.5
0000000000000b00 t frame_dummy
         U free@@GLIBC_2.2.5
         U getenv@@GLIBC_2.2.5
0000000000000b0a T hmac_sha256
00000000000014ca T main
         U malloc@@GLIBC_2.2.5
         U memcpy@@GLIBC_2.14
         U memset@@GLIBC_2.2.5
         U printf@@GLIBC_2.2.5
         U puts@@GLIBC_2.2.5
         U rand@@GLIBC_2.2.5
0000000000000a70 t register_tm_clones
         U sleep@@GLIBC_2.2.5
00000000000014b7 T sorry
         U srand@@GLIBC_2.2.5
         U strlen@@GLIBC_2.2.5
         U time@@GLIBC_2.2.5
0000000000000f18 T tohex
0000000000208060 D winnermsg
0000000000000fd7 T winnerwinner</code></pre>
<div style="height:20px" aria-hidden="true" class="wp-block-spacer"></div>
<p>Open the file &apos;sleighbell-lotto&apos; in gdb and jump to the function &apos;winnerwinner&apos; to complete the challenge</p>
<pre class="wp-block-code code-black-background"><code>elf@7b861946cf3f:~$ gdb -q ./sleighbell-lotto
Reading symbols from ./sleighbell-lotto...(no debugging symbols found)...done.
(gdb) break main
Breakpoint 1 at 0x14ce
(gdb) run
Starting program: /home/elf/sleighbell-lotto
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.

Breakpoint 1, 0x00005555555554ce in main ()
(gdb) jump winnerwinner
Continuing at 0x555555554fdb.

                           .....          ......
                   ..,;:::::cccodkkkkkkkkkxdc;.   .......
               .&apos;;:codkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx.........
             &apos;:okkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx..........
           .;okkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkdc..........
          .:xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkko;.     ........
        &apos;lkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx:.          ......
        ;xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkd&apos;
      .xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx&apos;
       .kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx&apos;
       xkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkx;
      :olodxkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk;
     ..........;;;;coxkkkkkkkkkkkkkkkkkkkkkkc
   ...................,&apos;,,:lxkkkkkkkkkkkkkd.
   ..........................&apos;;;:coxkkkkk:
    ...............................ckd.
      ...............................
        ...........................
           .......................
                ....... ...

With gdb you fixed the race.
The other elves we did out-pace.
  And now they&apos;ll see.
  They&apos;ll all watch me.
I&apos;ll hang the bells on Santa&apos;s sleigh!

Congratulations! You&apos;ve won, and have successfully completed this challenge.
[Inferior 1 (process 26) exited normally]
(gdb)</code></pre>
</div></body></html>
